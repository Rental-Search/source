{% extends "base.html" %}
{% load i18n product cache paginator %}

{% block title %}{{ patron.username }}{% endblock %}

{% block description %}
 {% blocktrans with patron.username as username %}Toutes les locations de {{ username }}{% endblocktrans %}
{% endblock %}

{% block content %}
<div id="search" class="xgrid">
    <div class="x12">
	  <h1>{% trans "Avec e-loue, tout se loue !" %}</h1>
	</div>
	<form class="form" action="{% url product_list %}">
	<div class="x5">
		<p>
			<label for="id_q">{% trans "Que voulez-vous louer ?" %}</label><br />
			{{ form.q }}<br />
			<span>{% trans "Exemple :" %} </span> <a href="{% url product_list %}?q={% trans "voiture" %}">{% trans "Voiture" %}</a>, <a href="{% url product_list %}?q={% trans "chèvre" %}">{% trans "Chèvre" %}</a>, <a href="{% url product_list %}?q={% trans "ski" %}">{% trans "Ski" %}</a>, <a href="{% url product_list %}?q={% trans "robe" %}">{% trans "Robe" %}</a>
		</p>
	</div>
	<div class="x5">
		<p>
			<label>{% trans "Où ?" %}</label><br />
			{{ form.l }}<br />
		</p>
	</div>
	<div class="x2">
		<p>
			<input type="submit" value="{% trans "Rechercher" %}" class="btn big-orange"/>
		</p>
	</div>
	</form>
</div>
<div id="content-home" class="xgrid">
    <div class="x3">
        <div class="box-welcome" style="height: 93px;">
            {% if patron.avatar %}
            <img src="{{ patron.avatar.product_page.url }}" alt="{% trans "loueur"%}{{ patron.username }}" style="float: left; margin-right: 10px; border: 1px solid #9EB0BA;">
            {% else %}
            <img src="{{ MEDIA_URL }}images/default_avatar.png" alt="{% trans "loueur"%}{{ patron.username }}" style="float: left; margin-right: 10px; border: 1px solid #9EB0BA;">
            {% endif %}
            <p style="text-align: left;">
                {{ patron.username }}
            </p>
            <p style="font-size: 12px; text-align: left; margin-bottom: 0px; ">
                {% with patron.addresses.all|first as address %}
					{{ address.zipcode }} {{ address.city|capfirst }}
				{% endwith %}
            </p>
        </div>
    </div>
    <div class="x9">
        <div class="x9 content-header" style="margin-left: 0px;">
            <h1>{% trans "Mes objets"%}</h1>
        </div>
        {% if patron.products %}
	     {% blocktrans with patron.products.count as count and patron.products.count|pluralize as pluralize %}
	      <h2>{{ count }} location{{ pluralize }}</h2>
	     {% endblocktrans %}
		{% else %}
			<h2>{% trans "Pas de location" %}</h2>
		{% endif %}
		<ul class="product-list">
		{% for product in product_list %}
		  {% cache 900 product:patron:row product.id site %}
		    <li>
                <a class="pl-img" href="{{ product.get_absolute_url }}">
                {% with product.pictures.all|first as picture %}
                    {% if picture.thumbnail %}
        			<img src="{{ picture.thumbnail.url }}" alt="product.summary" />
                    {% endif %}
                {% endwith %}
                </a>
                <div class="pl-header">
                    <h2><a href="{{ product.get_absolute_url }}">{{ product.summary }}</a></h2>
                </div>
                <div class="pl-content">
                    <div class="pl-desc">
                        {{ product.description }}
                    </div>
                    <div class="pl-distance">
                        
                    </div>
                    <div class="pl-price">
                        {% with product.prices.day|first as price %}
            				<span class="price">{{ price }}</span><br />
            				<span class="unit">{% trans "par" %} {{ price.unit|unit }}</span>
                        {% endwith %}
                    </div>
                    <div class="pl-btn">
                         <a href="{{ product.get_absolute_url }}" class="btn small-blue">{% trans "Réserver &rarr;" %}</a>
                    </div>
                </div>
            </li>
            {% endcache %}
    	{% endfor %}
		</ul>
		{% pagination %}
        {% if is_paginated %}
    	<div class="pages">
            <ul class="pages-list">
                {% if page_obj.has_previous %}
        		    <li class="previous">
        		        <a href="{% url patron_detail patron.slug page_obj.previous_page_number %}">&#171; {% trans "Page précédente" %}</a>
        		    </li>
        	    {% endif %}
    	        {% for page in page_range %}
    		        <li class="page-{{ page }} {% if page_obj.number == page %}select{% endif %}">
    		            <a href="{% url patron_detail patron.slug page %}">{{ page }}</a>
    		        </li>
    		    {% endfor %}
    	        {% if page_obj.has_next %}
        		    <li class="next">
        		        <a href="{% url patron_detail patron.slug page_obj.next_page_number %}">{% trans "Page suivante" %} &#187;</a>
        		    </li>
        	    {% endif %}
            </ul>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}