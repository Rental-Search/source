{% extends "base.html" %}
{% load i18n product cache paginator %}

{% block title %}{{ block.super }} - {{ patron.username }}{% endblock %}

{% block description %}{{ block. }}{% endblock %}

{% block content %}
<div id="top-content" class="search clearfix">
	<form class="form" action="{% url product_list %}">
	<div class="search-what x5">
		<label for="id_q">{% trans "Que voulez-vous louer ?" %}</label><br />
		{{ form.q }}<br />
		<span>{% trans "Exemple :" %} </span> <a href="location/?q=voiture">{% trans "Voiture" %}</a>, <a href="#">{% trans "Chèvre" %}</a>, <a href="#">{% trans "Ski" %}</a>, <a href="#">{% trans "Robe" %}</a>
	</div>
	<div class="search-where x5">
		<label>{% trans "Où ?" %}</label><br />
		{{ form.l }}<br />
	</div>
	<div class="search-find x2">
		<input type="submit" value="{% trans "Rechercher" %}" class="btn big-orange"/>
	</div>
	</form>
</div>{# top-content #}
<div id="content" class="public-profil clearfix">
	<div class="content-header x12">
		<h1>{{ patron.username }}</h1>
	</div>
	<div class="col1 x3">
		<div class="pp-info x3 first">
			<p>
				{% with patron.addresses.all|first as address %}
					{{ address.city|capfirst }}, {{ address.zipcode }}
				{% endwith %}
			</p>
		</div>
	</div>
	<div class="col2 x9">
		{% if patron.products %}
			<h2>{{ patron.products.count}} location{{ patron.products.count|pluralize }}</h2>
		{% else %}
			<h2>Pas de location</h2>
		{% endif %}
		<ul class="product-list x8 first">
		 {% for product in product_list %}
		  {% cache 900 product:patron:row product.id %}
			<li class="x8 first">
			 <a class="pl-img" href="{{ product.get_absolute_url }}">
			  {% with product.pictures.all|first as picture %}
		       {% if picture.thumbnail %}
				<img src="{{ picture.thumbnail.url }}" alt="product.summary" />
			   {% endif %}
		      {% endwith %}
			 </a>
			 <div class="pl-header">
			  <h2><a href="{{ product.get_absolute_url }}">{{ product.summary|capfirst|truncatewords:5 }}</a></h2>
			 </div>
			<div class="pl-content">
			 <div class="pl-desc">{{ product.description|truncatewords:12 }}</div>
			  <div class="pl-distance"></div>
			  <div class="pl-price">
			   {% with product.prices.day|first as price %}
				<span class="price">{{ price }}</span><br />
				<span class="unit">par {{ price.unit|unit }}</span>
			   {% endwith %}
			  </div>
			  <div class="pl-btn">
			   <a href="{{ product.get_absolute_url }}" class="btn small-blue">{% trans "Réserver" %} &rarr;</a>
			  </div>
			 </div>
			 <div class="pl-footer">
			  {{ product.address.city|capfirst }}, {{ product.address.zipcode }}
			 </div>
			</li>
		  {% endcache %}
		 {% endfor %}
		</ul>
	    {% pagination %}
	    {% if is_paginated %}
         <div class="pages x8 first">
          <ul class="pages-list">
	       {% if page_obj.has_previous %}
		    <li class="previous"><a href="{% url patron_detail patron.slug page_obj.previous_page_number %}">&#171; {% trans "Page précédente" %}</a></li>
	       {% endif %}
	       {% for page in page_range %}
		    <li class="page-{{ page }} {% if page_obj.number == page %}select{% endif %}"><a href="{% url patron_detail patron.slug page %}">{{ page }}</a></li>
		   {% endfor %}
	       {% if page_obj.has_next %}
		    <li class="next"><a href="{% url patron_detail patron.slug page_obj.next_page_number %}">{% trans "Page suivante" %} &#187;</a></li>
	       {% endif %}
	      </ul> 
         </div>{# pager #}
        {% endif %}
	</div>
</div>{# content #}

{% endblock %}
