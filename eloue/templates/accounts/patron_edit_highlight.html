{% extends "accounts/patron_edit.html" %}
{% load i18n product %}

{% block title %}{% trans "Mise en avant des annonces" %}{% endblock %}

{% block pro_opiton-submenu %}
<ul>
  <li><a href="{{ patron_edit_highlight }}" class="selected-nav-bar-link-sub">{% trans "Mise en avant" %}</a></li>	
  <li><a href="{{ patron_edit_notification }}">{% trans "Notifications" %}</a></li>
  <li><a href="{{ patron_edit_top_position }}">{% trans "Top position" %}</a></li>
</ul>
{% endblock %}

{% block tail %}
{{ block.super }}
<script type="text/javascript">
	$(document).ready(function (){
		$("a#add_new_highlight").click(function (e){
			e.preventDefault();
			$( "div#add_new_highlight_form" ).dialog(
				{ 
					resizable: false, 
					width: '350px'
				}
			);
		});

		$('td.highlight-action button').click(function (e){
			e.preventDefault();
			answer = confirm('Etes-vous sûr de vouloir retirer la mise en avant ?');
	        if (answer == true) {
	        	console.log(e, $(this), this.parentNode);
	        	this.parentNode.submit();
	            return true;
	        } else {
	            return false;
	        }
		});
	});
</script>
{% endblock %}

{% block content-main-profil %}
{% if request.user.current_subscription %}
<h2 style="margin-bottom: 30px">
	{% trans "Liste des annonces misent en avant"%}  <small style="padding-left: 50px;"><a href="#" id="add_new_highlight"><i class="icon-plus-sign"></i> {% trans "Ajouter une annonce" %}</a></small>
</h2>
<table class="table highlight-list">
	<thead>
		<tr>
			<th>Annonce</th>
			<th>Durée de mise en avant</th>
			<th></th>
		</tr>
	</thead>
	<tbody>
		{% for product in highlighted %}
			<tr>
				<td><a href="{{ product.get_absolute_url }}">{{ product.summary|truncate:38 }}</a></td>
				<td>{{ product.since|timesince }}</td>
				<td class="highlight-action">
					<form action="" method="post" style="margin-bottom: 0px;">
						{% csrf_token %}
						<input type="hidden" name="product" value="{{ product.pk }}" />
						<button><i class="icon-remove"></i> {% trans "Retirer la mise en avant"%}</button>
					</form>
				</td>
			</tr>
		{% empty %}
			<tr>
				<td colspan="3" class="no-highlight">
					{% trans "Pas d'annonce mise en avant. Pensez-y pour ameliorer votre visibilité." %}
				</td>
			</tr>
		{% endfor %}
	</tbody>
</table>
<div id="add_new_highlight_form" title="Mettre en avant une nouvelle annonce" style="display: none;">
	<form class="form" method="post" action="" style="margin-bottom: 0px; margin-top: 20px;">
		{% csrf_token %}
		<div class="control-group">
			<div class="controls">
				<select name="product" id="product">
					<option value="" selected="selected">Choisissez une annonce</option>
					{% for product in not_highlighted %}
						<option value="{{ product.pk }}">{{ product.summary }}</option>
					{% endfor %}
				</select>
			</div>
		</div>
		<div class="form-actions" style="padding-bottom: 0px; margin-bottom: 0px; padding-left: 205px;">
	    	<button type="submit" class="btn btn-primary">{% trans "Valider" %}</button>
	    </div>
	</form>
</div>
{% else %}
<div style="text-align: center;">
	<h2>{% trans "Mise en avant" %}</h2>
	<img src="{{ STATIC_URL }}images/options_pro/highlight.png" alt="Mise en avant" width="180" height="180" style="margin-bottom: 10px;">
	<p style="font-size: 14px; margin-bottom: 10px;">Votre annonce est mise en avant dans toutes nos listes (page d’accueil,<br>résultats de recherche, annonces similaires).</p>
	<p style="font-size: 14px; margin-bottom: 10px;">
	  {% trans "Pour bénéficier de cet avantage, accédez à l'espace pro pour en savoir plus :"%}
	</p>
	<p style="text-align: center;">
	  <a href="{% url 'accounts.views.patron_subscription' %}" class="btn-pro-access">{% trans "Professionnel ? Accédez à notre espace pro"%}</a>
	<p>
</div>
{% endif %}
{% endblock %}
