{% extends "base.html" %}
{% load i18n navbar %}

{% block title %}{% trans "Votre tableau de bord" %}{% endblock %}

{% block content %}
<div id="profil" class="container-main">
    <div class="top-bar">
        {% url dashboard as dashboard %}
        {% url inbox as inbox %}
        {% url borrower_booking_pending as borrower_booking %}
        {% url owner_product as owner_product %}
        {% url patron_edit as patron_edit %}
        <ul class="nav-bar">
            <li><a href="{{ dashboard }}" class="{% active request dashboard %}">{% trans "Tableau de bord" %}</a></li>
            <li>
                <a href="{{ inbox }}" class="{% active request "^/dashboard/messages/" %}">
                    {% trans "Messages" %} 
                    {% if unread_message_count > 0 %}
                        ({{unread_message_count}})
                    {% endif %}
                </a>
            </li>
            <li>
                <a href="{{ borrower_booking }}" class="{% block borrower_booking %}{% endblock %}{% active request  "^/dashboard/borrower/" %}">
                    {% trans "Mes réservations" %}
                    {% with request.user.rentals.authorized.count|add:request.user.rentals.pending.count|add:request.user.rentals.ongoing.count as count %}
                        {% if count > 0%}
                            ({{count}})
                        {% endif %}
                    {% endwith %}
                </a>
            </li>
            <li>
                <a href="{{ owner_product }}" class="{% block owner_product %}{% endblock %}{% active request "^/dashboard/owner/" %}">
                    {% trans "Mes annonces" %}
                    {% with request.user.bookings.authorized.count|add:request.user.bookings.pending.count|add:request.user.bookings.ongoing.count as count %}
                        {% if count > 0%}
                            ({{count}})
                        {% endif %}
                    {% endwith %}
                </a>
            </li>
            <li><a href="{{ patron_edit }}" class="{% active request patron_edit %}">{% trans "Paramètres de compte" %}</a></li>
        </ul>
    </div>{# top-bar #}
    <div class="content-aside-profil">
        {% block content-aside-profil %}
        <div class="profil-block">
            <div class="avatar-picture" style="margin-top: 0px; position: relative;">
                {% if user.avatar %}
                <img src="{{ user.display.url }}" width="180" height="180">
                {% else %}
                <img src="{{ MEDIA_URL }}images/default_avatar.png" width="180" height="180">
                <a href="{% url patron_edit %}#id_username" class="add-avatar-link">Ajouter une photo<br>de profil</a>
                {% endif %}
                <h1>{{ user.first_name }} {{ user.last_name }}</h1>
                <address>{{ user.default_address.city }} - {{ user.default_address.zipcode}}</address>
            </div><!-- avatar-picture -->
            <div class="profil-intro-content">
                {% if user.about %}
                    <p class="profil-description">{{ user.about }}</p>
                {% endif %}
                <a href="{% url patron_edit %}#extraInfo" class="btn-contactme">Editer mon profil</a>
            </div><!-- profil-description -->
        </div><!-- profil-block -->
        {% if user.work or user.school or user.languages.count %}
        {% with user as patron %}
            {% if patron.is_professional %}
                {% include "accounts/partials/company_more_info.html" %}
            {% else %}
                {% include "accounts/partials/more_info.html" %}
            {% endif %}
        {% endwith %}
        {% endif %}
        <div class="profil-block last">
            {% with user as patron %}
                {% if not patron.is_professional %}
                    {% include "accounts/partials/response_stats.html" %}
                {% endif %}
            {% endwith %}
        </div>{# profil-block #}
        {% endblock %}
    </div>{# content-aside-profil #}
    <div class="content-main-profil">
        {% include "partials/alerts_message.html" %}
        {% block content-main-profil %}
        <div class="dashboard-last-message">
            <h2 style="margin-bottom: 20px;">{% trans "Vos nouveaux messages" %}</h2>
            {% if thread_list %}
            {% include 'products/partials/message_list.html' %}
            {% else %}
            <p>Vous n'avez pas de nouveau message.</p>
            {% endif %}
            <p style="text-align: right;"><a href="{% url inbox %}">Lire tous vos messages.</a></p>
        </div>
            {% if booking_demands %}
            <h2 style="margin-bottom: 20px;">{% trans "Demandes de location" %}</h2>
            {% with booking_demands as object_list %}
                {% include 'accounts/partials/booking_list_owner.html' %}
            {% endwith %}
            {% endif %}
        {% endblock %}
    </div>{# content-main-profil #}
</div>{# profil #}
{% endblock %}
