{% extends "base.html" %}
{% load i18n product %}

{% block title %}{% trans "Payez votre réservation" %}{% endblock %}

{% block content %}
<div id="wizard-page" class="container-main">
  <ul class="breadcrumb">
    <li><a href="{% url home %}">{% trans "Accueil" %}</a></li>
    <li><a href="{{ request.HTTP_REFERER }}">{{ wizard_title }}</a></li>
    <li>{% trans "Paiement de la réservation" %}</li>
  </ul>
  <div class="content-main">
    <h2>{% trans "Récapitulatif de votre réservation" %}</h2>
    <form class="form-horizontal" action="" method="POST">
    {% csrf_token %}
      <table class="table table-bordered booking-resume">
      <tbody>
          <tr>
              <th style="vertical-align: middle; text-align">
                {% if product.carproduct %}
                  {% trans "Véhicule" %}
                {% else %}
                  {% if product.realestate.product %}
                    {% trans "Logement" %}
                  {% else %}
                    {% trans "Produit" %}
                  {% endif %}
                {% endif %}
              </th>
              <td>
                {% with product.pictures.all|first as picture %}
                {% if picture %}
                    <img src="{{ picture.thumbnail.url }}" alt="{{ product.summary }}" style="float: left; margin-right: 10px;">
                {% endif %}
                {% endwith %}
                <h3>{{ product.summary|capfirst }}<h3> 
                <span style="font-size: 13px">{{ product.address.city|capfirst }} - {{ product.address.zipcode }}</span>
              </td>
          </tr>
          <tr>
            <th>{% trans "Propriétaire" %}</th>
            <td>{{ product.owner.username }}</td>
          </tr>
          <tr>
            <td colspan="2" style="font-size: 12px;">L'intégralité des informations sur le propriétaire vous seront communiquées après l'acceptation définitive de la réservation par celui-ci.</td>
          </td>
          <tr>
              <th>{% trans "Réservation" %}</th>
              <td><b>Du</b> {{preview.started_at|date:"l d F Y H:i"}} <b>au</b> {{preview.ended_at|date:"l d F Y H:i"}}</td>
          </tr> 
          <tr>
              <th>{% trans "Montant de la réservation" %}</th>
              <td class="align-center">{{preview.total_amount}} &euro;</td>
          </tr>
      </tbody>
      </table>
      {% if product.carproduct %}
        <h2>{% trans "Informations sur le conducteur" %}</h2>
      {% else %}
          <h2>{% trans "Informations sur le locataire" %}</h2>
      {% endif %}
        <table class="table table-bordered booking-resume">
          <tr>
            <th>{% trans "Nom et Prénom" %}</th>
            <td>{% firstof new_patron.first_name preview.first_name %} {% firstof new_patron.last_name preview.last_name %}</td>
          </tr>
          <tr>
            <th>{% trans "Téléphone" %}</th>
            <td>
              {%firstof preview.phones__phone new_patron.phones.all|first %}
            </td>
          </tr>
          <tr>
            <th>{% trans "Adresse" %}</th>
            <td>
              {% if preview.addresses %}
                {{ preview.addresses }}
              {% else %}
                {{preview.addresses__address1}} {{preview.addresses__zipcode}} {{preview.addresses__city}} {{preview.addresses__country}}
              {% endif %}
            </td>
          </tr>
          {% if product.carproduct %}
          <tr>
            <th>{% trans "Date et lieu de naissance" %}</th>
            <td>Le {% firstof new_patron.date_of_birth|date:"d/m/Y" preview.date_of_birth|date:"d/m/Y" %} à {% firstof new_patron.place_of_birth preview.place_of_birth %}</td>
          </tr>
          <tr>
            <th>{% trans "Permis de conduire" %}</th>
            <td>{% trans "N°" %} {%firstof new_patron.drivers_license_number preview.drivers_license_number %} {% trans "délivré le" %} {% firstof new_patron.drivers_license_date|date:"d/m/Y" preview.drivers_license_date|date:"d/m/Y" %}</td>
          </tr>
          {% else %}
            {% if product.realestateproduct %}
            {% else %}
            {% endif %}
          {% endif %}
        </table>

        <h2>{% trans "Assurance" %}</h2>
        <table class="table table-bordered booking-resume">
          <tr>
            <th>
              {% trans "Conditions" %}
            </tf>
            <td>
              <ul>
                <li>
                  Le conducteur doit être titulaire d'un permis de conduire obtenu depuis plus de 2 ans valable en France
                </li>
                <li>
                  Le conducteur doit payer la location sur le site avec une carte bancaire à son nom qu'il présentera au propriétaire au début de la location, ainsi que son permis de conduire.
                </li>
                <li>
                  Il est possible d'avoir plusieurs conducteurs. Dans ce cas, chaque conducteur devra être mentionné sur le contrat de location et répondre aux conditions d'age et de permis de conduire.
                </li>
              </ul>
            </td>
          </tr>
          <tr>
            <th>
              {% trans "Dépôt de garantie" %}
            </th>
            <td>
              2000 &euro;<br>
              (Uniquement débité en cas de dommage constaté et avec votre accord)
            </td>
          </tr>
        </table>
        <h2>{% trans "Paiement" %}</h2>
        <fieldset id="credit-card-form">
        <div class="control-group {% if form.card_number.errors %} error {% endif %}">
          <label class="control-label" for="{{ form.card_number.id_for_label }}">
            {{ form.card_number.label }}
          </label>
          <div class="controls">
            {{ form.card_number }}
            <p class="help-block">{{ form.card_number.help_text}}</p>
            {% if form.card_number.errors %}
            <span class="help-inline">
            {% for error in form.card_number.errors %}
              {{ error|escape }}
            {% endfor %}
            </span>
            {% endif %}
          </div>{# controls #}
        </div>{# control-group #}
        <div class="control-group {% if form.cvv.errors %} error {% endif %}">
          <label class="control-label" for="{{ form.cvv.id_for_label }}">
            {{ form.cvv.label }}
          </label>
          <div class="controls">
            {{ form.cvv }}
            <p class="help-block">{{ form.cvv.help_text}}</p>
            {% if form.cvv.errors %}
            <span class="help-inline">
            {% for error in form.cvv.errors %}
              {{ error|escape }}
            {% endfor %}
            </span>
            {% endif %}
          </div>{# controls #}
        </div>{# control-group #}
        <div class="control-group {% if form.expires.errors %} error {% endif %}">
          <label class="control-label" for="{{ form.expires.id_for_label }}">
            {{ form.expires.label }}
          </label>
          <div class="controls">
            {{ form.expires }}
            <p class="help-block">{{ form.expires.help_text}}</p>
            {% if form.expires.errors %}
            <span class="help-inline">
            {% for error in form.expires.errors %}
              {{ error|escape }}
            {% endfor %}
            </span>
            {% endif %}
          </div>{# controls #}
        </div>{# control-group #}
        <div class="control-group {% if form.keep.errors %} error {% endif %}">
          <label class="checkbox" for="{{ form.keep.id_for_label }}">
            {{ form.keep }} {% trans "Conserver mes coordonnées bancaire" %}
          </label>
          <div class="controls">
            <p class="help-block">{{ form.keep.help_text}}</p>
            {% if form.keep.errors %}
            <span class="help-inline">
            {% for error in form.keep.errors %}
              {{ error|escape }}
            {% endfor %}
            </span>
            {% endif %}
          </div>{# controls #}
        <div class="control-group {% if form.holder_name.errors %} error {% endif %}">
          <label class="checkbox" for="{{ form.holder_name.id_for_label }}">
            {{ form.holder_name }} {% trans "Titulaire de la carte" %}
          </label>
          <div class="controls">
            <p class="help-block">{{ form.holder_name.help_text}}</p>
            {% if form.holder_name.errors %}
            <span class="help-inline">
            {% for error in form.holder_name.errors %}
              {{ error|escape }}
            {% endfor %}
            </span>
            {% endif %}
          </div>{# controls #}
        </div>{# control-group #}
      </fieldset>{# credit-card-form #}
      <div class="form-actions">
          <input type="hidden" name="{{ step_field }}" value="{{ step0 }}" />
          {{ previous_fields|safe }}
          <button type="submit" class="btn btn-primary">{% trans "Paiment" %}</button>
      </div>
    </form>
  </div>
</div>{# container_main #}
{% endblock %}

{% block footer %}
{% endblock %}