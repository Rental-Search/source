{% extends "accounts/patron_edit.html" %}
{% load i18n navbar %}

{% block title %}{% trans "Votre profil" %}{% endblock %}
{% block head %}
  {{block.super}}

  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
{% endblock %}

{% block content-main-profil %}
{% if  commented_bookings %}
  <h2>{% trans "Vos commentaires" %}</h2>
  <ul class="comments">
  {% for booking in commented_bookings %}
    {% if request.user == booking.owner %}
      {% with booking.ownercomment as comment %}
        <li>{% include 'rent/partials/comment.html' %}</li>
      {% endwith %}
    {% else %}
      {% with booking.borrowercomment as comment %}
        <li>{% include 'rent/partials/comment.html' %}</li>
      {% endwith %}
    {% endif %}
  {% endfor %}
  </ul>
{% endif %}

{% if forms %}
<h2>{% trans "Commentaires à écrire" %}</h2>
{% for form in forms %}
<form class="form-horizontal" method="post" action="">
  <legend style="font-size: 14px;">
    {% trans "Réservation du" %} {{form.instance.booking.started_at|date:"l d F Y"|capfirst}} {% trans "au"%} {{form.instance.booking.ended_at|date:"l d F Y"|capfirst}}
    <a href="{{ form.instance.booking.get_absolute_url }}">({{ form.instance.booking.product.summary }})</a>
  </legend>
  {% csrf_token %}
  {% for formfield in form %}
    <div class="control-group {% if formfield.errors %} error {% endif %}">
      <label class="control-label" for="{{ formfield.id_for_label }}">{{ formfield.label }} {% if formfield.field.required %}*{% endif %}</label>
      <div class="controls">
        {{ formfield }}
        <p class="help-block">{{ formfield.help_text }}</p>
        {% if formfield.errors %}
          <span class="help-inline">
          {% for error in formfield.errors %}
            {{ error|escape }} 
          {% endfor %}
          </span>
        {% endif %}
      </div>
    </div>
  {% endfor %}
    <div class="form-actions">
      <input type="submit" name="{{form.instance.booking.pk.hex}}" class="btn big-green" value="Enregistrer">
    </div>
</form>
{% endfor %}
{% endif %}
{% if not commented_bookings and not forms %}
  <p style="text-align: center;">Pas de commentaires</p>
{% endif %}
{% endblock %}

