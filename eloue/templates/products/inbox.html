{% extends "accounts/dashboard.html" %}
{% load i18n navbar %}

{% block title %}{% trans "Mes messages reçus" %}{% endblock %}
{% block head %}
    {{block.super}}
{% endblock %}

{% block content-aside-profil %}
{% url inbox as inbox %}
{% url archived as archived %}
<ul class="nav-sub-bar">
    <li><a href="{{ inbox }}"  class="{% active request inbox %}">{% trans "Massages reçus" %}</a></li>
    <li><a href="{{ archived }}" class="{% active request archived %}">{% trans "Messages supprimés" %}</a></li>
</ul>
{% endblock %}

{% block content-main-profil %}
{% if thread_list %}
<ul class="messages">
	{% for thread in thread_list %}
	<li>
		{% if request.user == thread.sender %}
			{% if thread.new_sender %}
				NEW
			{%endif%}
		{% else %}
			{% if thread.new_recipient %}
				NEW
			{% endif %}
		{% endif %}
		<a href="{% url thread_details thread_id=thread.id%}" class="m-img">
			{% if request.user == thread.sender %}
				{% if thread.recipient.avatar %}
					<img src="{{ thread.recipient.avatar.thumbnail.url }}" widht="60" height="60" alt=""/>
				{% else %}
					<img src="{{ MEDIA_URL }}images/default_avatar.png" width="60" height="60" alt="">
				{% endif %}
			{% else %}
				{% if thread.sender.avatar %}
					<img src="{{thread.sender.avatar.thumbnail.url}}" width="60" height="60" alt=""/>
				{% else %}
					<img src="{{ MEDIA_URL }}images/default_avatar.png" width="60" height="60" alt="">
				{% endif %}
			{% endif %}
		</a>
		<div class="m-content">
			<div>
				<p class="m-sender">
					<a href="{% url thread_details thread_id=thread.id%}">
						{% if request.user == thread.sender %}
							{{thread.recipient.username }}
						{% else %}
							{{thread.sender.username }}
						{% endif %}
					</a>
					{{ thread.last_message.sent_at|date:_("DATETIME_FORMAT") }}
					<span class="m-action"><a href="{% url thread_details thread_id=thread.id %}">{% trans "Lire" %}</a></span> -
					<span class="m-action"><a href="{% url archive_thread thread_id=thread.id %}">{% trans "Archiver" %}</a></span>
				</p>
				<div class="m-subject">{{ thread.subject }}</div>
				<span class="message-dial"></span>
			</div>
		</div>
	</li>
	{% endfor %}
</ul>{# message_list #}
{% endif %}
{% endblock %}