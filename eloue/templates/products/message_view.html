{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans "Message" %} : {{ message.subject }}{% endblock %}

{% block content %}
<div id="content" class="xgrid">
    <div class="content-top">
        <ul id="menu" class="x12">
			<li class="menu-tab first"><a href="{% url dashboard %}">{% trans "Tableau de bord" %}</a></li>
			<li class="menu-tab"><a href="{% url owner_booking %}">{% trans "Propriétaire" %}</a></li>
			<li class="menu-tab"><a href="{% url borrower_booking %}">{% trans "Locataire" %}</a></li>
			<li class="menu-tab"><a href="{% url patron_edit %}">{% trans "Mon compte" %}</a></li>
			<li class="menu-tab"><a href="{% url inbox %}">{% blocktrans %}Messages({{ unread_message_count }}){% endblocktrans %}</a></li>
		</ul>
	</div>
	<div id="sub-menu">
		<ul class="x12">
			<li class="sub-tab first selected"><a href="{% url inbox %}">{% trans "Messages reçus"%}</a></li>
			<li class="sub-tab"><a href="{% url archived %}">{% trans "Messages archivés" %}</a></li>
		</ul>
	</div>
	{% for message in message_list %}
	{% if forloop.first %}
	<div class="content-header x12">
		{% if request.user == message.recipient %}
	    <h1>Conversation avec {{ message.sender }}</h1>
	    {% else %}
	    <h1>Conversation avec {{ message.recipient }}</h1>
	    {% endif %}
	</div>
	<ul class="x8">
	{% endif %}
	{% if forloop.last %}
	<li style="padding: 10px 0;">
		{% if message.sender.avatar %}
	    <img src="{{message.sender.avatar.thumbnail.url}}" style="float: left; margin-right: 10px;">
	    {% else %}
	    <img src="{{ MEDIA_URL }}images/bk_borrower_img.png" style="float: left; margin-right: 10px;">
	    {% endif %}
	    <div class="message-content" style="display: table-cell; vertical-align: top;  width: 570px;">
	        <div class="message-sender" style="margin-bottom: 5px;">
	            <div style="float: right; font-size: 12px;">{{ message.sent_at|date:_("DATETIME_FORMAT")}}</div>
	            <strong>{{ message.sender }}</strong>
	        </div>
	        <div class="message-body">
	            {{ message.body|linebreaks }}
	        </div>
	    </div>
	</li>
	{% else %}
	<li style="padding: 10px 0; border-bottom: 1px dashed #B9CAD4;">
		{% if message.sender.avatar %}
	    <img src="{{message.sender.avatar.thumbnail.url}}" style="float: left; margin-right: 10px;">
	    {% else %}
	    <img src="{{ MEDIA_URL }}images/bk_borrower_img.png" style="float: left; margin-right: 10px;">
	    {% endif %}
	    <div class="message-content" style="display: table-cell; vertical-align: top; width: 570px;">
	        <div class="message-sender" style="margin-bottom: 5px;">
	            <div style="float: right; font-size: 12px;">{{ message.sent_at|date:_("DATETIME_FORMAT")}}</div>
	            <strong>{{ message.sender }}</strong>
	        </div>
	        <div class="message-body">
	            {{ message.body|linebreaks }}
	        </div>
	    </div>
	</li>
	{% endif %}
	{% endfor %}
	</ul>
	<div id="submit-wizard" class="x12">
	    <style>
	        #id_0-body { height: 60px; }
	    </style>
	    <form action="" method="post">
	        {% csrf_token %}
	        <p style="text-align: left;">
	            {{ editForm.body }}<br />
        	    <input type="submit" class="btn small-green" style="font-size: 12px;" value="Répondre">
        		{% if request.user == thread.sender %}
				    {% if thread.sender_archived %}<a href="{% url unarchive_thread thread_id=thread.id %}">unarchive</a>
				    {% else %}<a href="{% url archive_thread thread_id=thread.id %}">archive</a>
	    {% endif %}
        		{% else %}
				    {% if thread.recipient_archived %}<a href="{% url unarchive_thread thread_id=thread.id %}">unarchive</a>
				    {% else %}<a href="{% url archive_thread thread_id=thread.id %}">archive</a>
	    {% endif %}
        		{% endif %}
        	</p>
	    </form>
    </div>
</div>
{% endblock %}