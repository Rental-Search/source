{% extends "base.html" %}
{% load i18n mptt_tags product cache %}

{% block title %}{{ block.super }} - Plateforme pour louer ou mettre en location tout type d'objet : materiel, reception, mariage, sono, utilitaires, ski ...{% endblock %}

{% block content %}
	<div id="top-content" class="search clearfix">
		<div class="search-header x12">
			<h1>{% trans "Recherchez toutes vos locations sur e-loue" %}</h1>
		</div>
		<form class="form" action="{% url product_list %}">
		<div class="search-what x5">
			<label for="id_q">{% trans "Que voulez-vous louer ?" %}</label><br />
			{{ form.q }}<br />
			<span>{% trans "Exemple :" %} </span> <a href="location/?q=voiture">{% trans "Voiture" %}</a>, <a href="#">{% trans "Chèvre" %}</a>, <a href="#">{% trans "Ski" %}</a>, <a href="#">{% trans "Robe" %}</a>
		</div>
		<div class="search-where x5">
			<label>{% trans "Où ?" %}</label><br />
			{{ form.l }}<br />
		</div>
		<div class="search-find x2">
			<input type="submit" value="{% trans "Rechercher" %}" class="btn big-orange"/>
		</div>
		</form>
	</div>{# top-content #}
	<div id="content" class="clearfix">
		<div class="content-header x12">
		 <h2>{% trans "Catégories" %}</h2>
		</div>
		{% cache 900 categories %}
		 {% full_tree_for_model products.Category as categories %}
		 {% for column in categories|partition:4 %}
		  <div class="x3">
		   {% for category in column %}
		    {% if category.is_root_node %}
		     {% drilldown_tree_for_node category as drilldown cumulative count products.Product.category in product_count %}
		     {% for node,structure in drilldown|tree_info %}
		      {% if node.is_root_node %}
		       <div class="category-home x3 first">
		        <h3>{{ node.name }}</h3>
		        <ul>
		      {% else %}
		       {% if node.product_count %}
		        <li><a href="{{ node.get_absolute_url }}">{{ node.name }} ({{ node.product_count }})</a></li>
		       {% endif %}
		      {% if structure.closed_levels|length >= 2 %}</ul></div>{% endif %}
		     {% endif %}
		    {% endfor %}
		   {% endif %}
		  {% endfor %}
		 </div>
	    {% endfor %}
	   {% endcache %}
	</div>{# content #}
{% endblock %}